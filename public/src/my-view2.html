<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
  <!-- Import custom element. Note: see comment about relative paths to dependencies in the *.html file referenced below -->
  <link rel="import" href="../bower_components/px-theme/px-theme.html"/>
  <link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"/>
  <link rel="import" href="../bower_components/px-chart/px-chart.html"/>

<dom-module id="my-view2">

  <template>

    <style>
      :host {
        display: block;
        padding: 10px;
      }
      .card {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        padding: 16px;
        margin: 24px;
        border-radius: 5px;
        background-color: #fff;
        color: #757575;
      }
      .circle {
        display: inline-block;
        height: 64px;
        width: 64px;
        border-radius: 50%;
        background: #ddd;
        line-height: 64px;
        font-size: 30px;
        color: #555;
        text-align: center;
      }
      h1 {
        font-size: 22px;
        margin: 16px 0;
        color: #212121;
      }
    </style>

    <div class="card">
      <div class="circle">1</div>

      <px-chart tooltip-type="condensed" series-events-width="1" zoom-type="xy" zoom-controls="hidecontrols">
          <px-chart-controls data-controls show-date-range="true" display-options='{ "displayType": "normal","submitButtonText": "Update", "submitButtonIcon": "icon-arrow-right" }'></px-chart-controls>
          <px-chart-yaxis title='{"text": "Left Axis"}' id="firstAxis" offset="0"></px-chart-yaxis>
          <px-chart-yaxis title='{"text": "Right Axis"}' id="anotherAxis" opposite="true" offset="-2.5"></px-chart-yaxis>
          <px-chart-series-line id="delta-egt-cruise" axis-id="firstAxis" upper-threshold="30.5" lower-threshold="6.25" units="Hz">
            <iron-ajax
              url="../bower_components/px-demo-data/demo-data/aviation/delta-egt-cruise.json"
              handle-as="json"></iron-ajax>
          </px-chart-series-line>
          <px-chart-series-line id="fan-vibration-cruise" axis-id="anotherAxis" units="Hz">
            <iron-ajax
              url="../bower_components/px-demo-data/demo-data/aviation/fan-vibration-cruise.json"
              handle-as="json"></iron-ajax>
          </px-chart-series-line>
      </px-chart>

      <p class="u-mt+">
          Demo controls for full configuration chart:
          <button class="btn" onclick="togglePointMarkers()">Toggle Point Markers</button>
          <button class="btn" onclick="addSeries('core-vibe-rear-cruise', '../bower_components/px-demo-data/demo-data/aviation/core-vibe-rear-cruise.json')">Add Core Vibration Series</button>
          <button class="btn" onclick="removeSeries('core-vibe-rear-cruise')">Remove Core Vibration Series</button>
          <button class="btn" onclick="addSeries('fan-vibration-cruise', '../bower_components/px-demo-data/demo-data/aviation/fan-vibration-cruise.json')">Add Fan Vibration Series</button>
          <button class="btn" onclick="removeSeries('fan-vibration-cruise')">Remove Fan Vibration Series</button>
      </p>

    </div>

  </template>

  <script>

    Polymer({

      is: 'my-view2'

    });

document.addEventListener('WebComponentsReady', function() {

    //register series refresh listener for full config chart:
    Polymer.dom(document).querySelector('px-chart').addEventListener("refresh-series", function(evt) {
      if (evt.detail === "fan-vibration-cruise") {
        var ironAjaxEl = document.createElement('iron-ajax');
        ironAjaxEl.url = '/demo-data/aviation/fan-vibration-cruise2.json';
        ironAjaxEl.handleAs = "json";
        ironAjaxEl.addEventListener('response', function(evt) {
          var tsChart = Polymer.dom(document).querySelector('.full-config-example px-chart');
          tsChart.updateSeries('fan-vibration-cruise', evt.detail.response.series, /*noRedraw*/false);
        });

        ironAjaxEl.generateRequest();
      }
    });

  });

  function togglePointMarkers(evt){
    var tsChart = Polymer.dom(document).querySelector('px-chart');
    tsChart.togglePointMarkers(/*seriesIds*/null);
  }


  function addSeries(seriesId, seriesObjUrl) {
    var timeSeriesComp = document.querySelector("px-chart");
    if (timeSeriesComp.chart.get(seriesId)) {
      console.log("series " + seriesId + " already exists on chart.");
    }
    else {
      var ironAjaxEl = document.createElement("iron-ajax");
      ironAjaxEl.url = seriesObjUrl;
      ironAjaxEl.handleAs = "json";
      ironAjaxEl.addEventListener("response", function(evt) {
        timeSeriesComp.addSeries({
            id: seriesId,
            name: seriesId,
            data: evt.detail.response.series
          },
          /*noRedraw*/false
        );
      });

      ironAjaxEl.generateRequest();
    }
  }

  function removeSeries (seriesId) {
    var timeSeriesComp = document.querySelector("px-chart");
    if (timeSeriesComp.chart.get(seriesId)) {
      timeSeriesComp.removeSeries(seriesId);
    }
    else {
      console.log("series " + seriesId + " does not exist on chart.");
    }
  }
  </script>

</dom-module>
